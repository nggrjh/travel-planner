version: "3"

includes:
  docker: docker.yml

tasks:
  test:
    vars:
      DB_SCHEMA: pgtest
      DB_USER: pgtest
      DB_PASS: pgtest
      TEST_FILES: test/* -v
    deps:
      - docker:setup
    cmds:
      - ./bin/docker-compose -f ./config/test/docker-compose.yml up -d pgtest
      - ./bin/docker-compose -f ./config/test/docker-compose.yml up migrate
      - ./bin/docker-compose -f ./config/test/docker-compose.yml up pgtap
      - ./bin/docker-compose -f ./config/test/docker-compose.yml down
